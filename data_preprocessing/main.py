from dataclasses import dataclass

from data_preprocessing.data_preprocessor_builder import DataPreprocessorBuilder
from data_preprocessing.permission_category import NaticusdroidPermissionsFactory, PermissionCategory, \
    TUANDROMDPermissionsFactory


def main():
    datasets_folder_path = '../datasets/'
    data: list[Data] = [
        # Data(data_name='TUANDROMD', file_path=datasets_folder_path + 'TUANDROMD.csv',
        #      result_col_name='Label',
        #      columns_to_filter=['column1', 'column2'], permission_categories=TUANDROMDPermissionsFactory.create()),
        Data(data_name='Naticusdroid', file_path=datasets_folder_path + 'naticusdroid+android+permissions+dataset.csv', result_col_name='Result',
             columns_to_filter=['column1', 'column2'], permission_categories=NaticusdroidPermissionsFactory.create()),
        Data(data_name='Android_Malware_Benign', result_col_name='Label', file_path=datasets_folder_path + 'Android_Malware_Benign.csv',
             columns_to_filter=[], permission_categories=[])
    ]

    for d in data:
        DataPreprocessorBuilder(data_name=d.data_name, result_col_name=d.result_col_name) \
            .load_data(d.file_path) \
            .show_basic_statistics() \
            .add_sum_of_permitted_permissions() \
            .normalize_label() \
            .remove_unbalanced_columns(threshold=0.90) \
            .normalize_data() \
            .cut_names_from_all_columns() \
            .show_basic_statistics() \
            .build(folder_path='../processed_data')


@dataclass
class Data:
    data_name: str
    file_path: str
    result_col_name: str
    columns_to_filter: list[str]
    permission_categories: list[PermissionCategory]


if __name__ == '__main__':
    main()
