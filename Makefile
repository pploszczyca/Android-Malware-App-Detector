# Define the virtual environment and the python interpreter
VENV := venv
PYTHON := $(VENV)/bin/python

# Define your strategies
STRATEGIES := OnePermissionPerFeature GroupPermission

# Default target
all: help

# Target to activate the virtual environment (optional)
.PHONY: venv
venv:
	@echo "Activating virtual environment..."
	@source $(VENV)/bin/activate

# Target to run the data preprocessing script with a specified strategy
.PHONY: run run-data $(STRATEGIES)
run: run-data

run-data: $(STRATEGIES)
$(STRATEGIES):
	@echo "Running data preprocessing with strategy: $@"
	@$(PYTHON) -m data_preprocessing.main $@

# Target to run the training script
.PHONY: run-training
run-training: $(STRATEGIES)
$(STRATEGIES):
	@echo "Running training and plotting..."
	@$(PYTHON) -m training_models.main $@

# Target to run all steps
.PHONY: run-all
run-all:
	@$(MAKE) run-data OnePermissionPerFeature
	@$(MAKE) run-training OnePermissionPerFeature
	@$(MAKE) run-data GroupPermission
	@$(MAKE) run-training GroupPermission

# Help target to display usage
.PHONY: help
help:
	@echo "Makefile for running data preprocessing and training scripts"
	@echo ""
	@echo "Usage:"
	@echo "  make run STRATEGY=<strategy>  				- Run the data preprocessing script with the specified strategy"
	@echo "  make run-training STRATEGY=<strategy>      - Run the training and plotting script"
	@echo "  make run-all                  				- Run data preprocessing and training for all strategies"
	@echo ""
	@echo "Available strategies:"
	@for strat in $(STRATEGIES); do echo "  $$strat"; done

# Clean up (optional)
.PHONY: clean
clean:
	@echo "Cleaning up..."
	@rm -rf __pycache__
